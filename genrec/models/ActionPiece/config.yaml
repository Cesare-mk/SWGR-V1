# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ==============================================================================

# Config for sentence embedding model
sent_emb_model: sentence-transformers/sentence-t5-xxl
sent_emb_batch_size: 16
sent_emb_dim: 768
sent_emb_pca: 128 # -1 means no PCA, otherwise PCA dimension

# Config for features
n_threads: 32
pq_n_codebooks: 4
pq_codebook_size: 256
n_hash_buckets: 128

# Config for the action tokenizer
actionpiece_vocab_size: 40000

# Config for the model
n_prob_encode_plus: 0
num_beams: 50 # Number of beams for beam search
n_inference_ensemble: 5 # Number of inference ensemble
train_shuffle: feature # none / feature / token

# Config for the task
max_item_seq_len: 20

# Config for T5
num_layers: 4
num_decoder_layers: 4
d_model: 128
d_ff: 1024
num_heads: 6
d_kv: 64
dropout_rate: 0.1
activation_function: "gated-gelu"
feed_forward_proj: "relu"

# 语义权重模式: 'proximity'(相似度) 或 'semantic_diversity'(多样性)
item_weight_mode: proximity

# Gamma参数: 控制语义权重的影响强度
# priority = cnt * (w1*w2)^(γ/2)
# 推荐值：Beauty=3.0, Sports=2.5~3.0, CDs=2.5
item_weight_gamma: 3.0

# 权重裁剪范围 [min, max]: 防止极端权重值
# - 第一次裁剪范围，用于初始权重计算
# 推荐值：Beauty=[0.2, 4.0], Sports=[0.4, 2.5], CDs=[0.3, 3.5]
item_weight_clip_range: [0.2, 4.0]

# 是否启用二次裁剪: 对log(weight)进行额外裁剪
# - True: 适用于权重分布极端的数据集(如Sports)
# - False: 适用于权重分布温和的数据集(如Beauty)
enable_second_clip: False

# 二次裁剪范围 [min, max]: 仅在enable_second_clip=true时生效
# - 对log(weight)进行裁剪，防止对数空间的极端值
# 推荐值：Sports=[-1.5, 1.5], CDs=[-1.0, 1.0]
log_weight_clip_range: [-1.5, 1.5]

# 权重分析间隔: 每训练N步输出一次权重有效性分析
weight_analysis_interval: 4000

# Ranking-guided generation loss temperature
# - 较小值(0.5-0.7): 更激进的排序优化，适合大数据集
# - 较大值(0.8-1.0): 更温和的排序优化，适合小数据集
# - 1.0: 等价于标准CE损失，不启用ranking优化
# 推荐值：Beauty=0.7, Sports=0.7, CDs=0.7
ranking_temperature: 0.7

# ============================================================================
# 权重公式说明:
#   priority = cnt * (w1 * w2)^(γ/2)
#   等价于：priority = exp(log(cnt) + γ/2 * (log_w1 + log_w2))
#
# 权重效应示例：
#   - 无权重: w1=w2=1.0 → weight_factor = 1.0^(γ/2) = 1.0
#   - 高相似度: w1=w2=2.0, γ=2.0 → weight_factor = 4.0^1.0 = 4.0
#   - 高相似度: w1=w2=2.0, γ=3.0 → weight_factor = 4.0^1.5 = 8.0
#   - 互补权重: w1=0.5, w2=2.0, γ=2.0 → weight_factor = 1.0^1.0 = 1.0
# ============================================================================
